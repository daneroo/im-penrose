function drawRhomb(e,i,r){a.beginPath(),a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[3].x,e[3].y),a.lineTo(e[2].x,e[2].y),a.globalAlpha=.3,a.fillStyle=pColor[(i+0*r)%eDim],a.fill(),a.strokeStyle="#268BD2",a.lineWidth=.02,a.stroke()}function intersect(i,r,a,n){var o=e[i],t=e[a],h={x:(r+g[i])*e[i].x,y:(r+g[i])*e[i].y},y={x:(n+g[a])*e[a].x,y:(n+g[a])*e[a].y},c=-o.y/o.x,x=-c*h.y+h.x,f=-t.x/t.y,s=-f*y.x+y.y,l=(f*x+s)/(1-f*c),u=c*l+x;return{x:u,y:l}}function intersectAndRhomb(i,r,a,n){var o,t,h,y,c=Array(eDim),x=intersect(i,r,a,n),f=[];for(h=0;eDim>h;h++)0!==e[h].x&&(o=-e[h].y/e[h].x,c[h]=(x.x-o*x.y)/(-o*e[h].y+e[h].x)-g[h]),0!==e[h].y&&(t=-e[h].x/e[h].y,c[h]=(x.y-t*x.x)/(-t*e[h].x+e[h].y)-g[h]),c[h]=Math.floor(c[h]);n0s=[r-1,r],n1s=[n-1,n],n0s.forEach(function(r){n1s.forEach(function(n){var o=c.slice(0);for(o[i]=r,o[a]=n,y={x:0,y:0},h=0;eDim>h;h++)y.x+=o[h]*e[h].x,y.y+=o[h]*e[h].y;f.push(y)})}),drawRhomb(f,i,a)}b.style.margin=0,X=b.clientWidth,Y=window.innerHeight-4,c.width=X,c.height=Y,a.translate(X/2,Y/2),a.scale(30,-30);var pColor=["#b58900","#D33682","#6C71C4","#2AA198","#859900","#CB4B16","#268BD2","#DC322F"],eDeg=[],eDim=5,e=[],g=[],i,rr=[],ii=[];for(i=0;eDim>i;i++)g.push(Math.random()),deg=90+i*(360/eDim),rad=deg*Math.PI/180,eDeg.push(deg),e.push({x:-Math.sin(rad),y:Math.cos(rad)});for(i=-5;5>=i;i++)rr.push(i);for(i=0;eDim>i;i++)ii.push(i);ii.forEach(function(e){ii.forEach(function(i){i!==e&&rr.forEach(function(r){rr.forEach(function(a){intersectAndRhomb(e,r,i,a)})})})});